<html layout:decorate="~{layout/user_layout}" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" xmlns:th="http://www.thymeleaf.org">

<div class="board-pageboard-page" id="postDetail" layout:fragment="content">
    <div class="col-lg-12">
        <div class="panel panel-default" th:object="${post}">
            <div class="p-sm-4 panel-heading">
                <p><span class="post-groupName" th:text="*{groupName}"></span><i>&gt;</i>
                    <span class="post-boardTitle"><a class="" th:href="@{/boardList/{boardNo}(boardNo=*{boardNo})}"
                                                     th:text="*{boardTitle}"></a></span>
                </p>
                <div class="post-subject" th:text="*{subject}"></div>
                <div class="post-info">
                    <span th:text="*{writerNick}"></span>
                    <i aria-hidden="true" class="fa fa-clock-o"></i> <span th:text="*{createDate}"></span>
                    <i aria-hidden="true" class="fa fa-eye"></i> <span th:text="*{views}"></span>
                    <i aria-hidden="true" class="fa fa-comment-o"></i> <span th:text="*{commont}"></span>
                </div>
            </div>
            <div class="panel-body post-content">
                <div class="p-sm-4">
                    <div class="map_wrap mb-5 " th:if="${mapVoForApi != null}">
                        <div id="map" style="height:100%;position:relative;overflow:hidden;"></div>
                        <div class="bg_white" id="menu_wrap">
                            <div class="option">
                                <div></div>
                            </div>
                            <ul id="placesList"></ul>
                            <div id="pagination"></div>
                        </div>
                    </div>
                    <div class="review" th:if="${review != null}">
                        <div class="mb-5">
                            <div class="fs-5 fw-bold mb-4 text-center">ÏûëÏÑ±ÏûêÍ∞Ä ÎÇ®Í∏¥ ÏàôÏÜå ÌèâÏ†ê
                                <p class="fs-6 fw-light" style="color: #696969;">ÏÜîÏßÅÌïòÍ≤å ÎÇ®Í≤®Ï£ºÏã† ÏÜåÏ§ëÌïú Î¶¨Î∑∞ÏûÖÎãàÎã§</p>
                            </div>
                            <ul class="star-area">
                                <li>
                                    <label>ÏúÑÏπò</label>
                                    <div class="star-box">
                                        <i th:each="num : ${#numbers.sequence(1,review.rateLoc)}"><img
                                                src="https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/apple/285/star_2b50.png"></i>
                                    </div>
                                </li>
                                <li>
                                    <label>ÏúÑÏÉù</label>
                                    <div class="star-box">
                                        <i th:each="num : ${#numbers.sequence(1,review.rateClean)}"><img
                                                src="https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/apple/285/star_2b50.png"></i>

                                    </div>
                                </li>
                                <li>
                                    <label>ÏùòÏÇ¨ÏÜåÌÜµ</label>
                                    <div class="star-box">
                                        <i th:each="num : ${#numbers.sequence(1,review.rateComu)}"><img
                                                src="https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/apple/285/star_2b50.png"></i>
                                    </div>
                                </li>
                                <li>
                                    <label>Í∞ÄÏÑ±ÎπÑ</label>
                                    <div class="star-box">
                                        <i th:each="num : ${#numbers.sequence(1,review.rateChip)}"><img
                                                src="https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/apple/285/star_2b50.png"></i>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="mb-4" th:if="${review.visitDate != null}">
                            <p class="m-0">
                                <label for="visitDate">Î∞©Î¨∏ ÎÇ†Ïßú</label>
                            </p>
                            <span id="visitDate" th:text="${review.visitDate}"></span>
                        </div>
                        <div class="mb-4" th:if="${review.recommendPlace != null}">
                            <p class="m-0">
                                <label for="recommendPlace">Ï£ºÎ≥Ä ÎßõÏßëÍ≥º Í¥ÄÍ¥ëÏßÄÎ•º Ï∂îÏ≤úÌï¥Ï£ºÏÑ∏Ïöîüëç</label>
                            </p>
                            <span id="recommendPlace" th:text="${review.recommendPlace}"></span>
                        </div>
                        <div class="mb-5" th:if="${review.notRecommendPerson != null}">
                            <p class="m-0">
                                <label for="notRecommendPerson">Ïù¥Îü∞ Î∂ÑÎì§ÍªòÎäî ÎπÑÏ∂îÏóêÏöîüëé</label>
                            </p>
                            <span id="notRecommendPerson" th:text="${review.notRecommendPerson}"></span>
                        </div>
                    </div>
                    <div class="mb-3" th:if="${attachList != null}">
                        <div class="photos">
                            <div id="images">
                                <img th:each="attach : ${attachList}" th:if="${attach.fileType == 1}"
                                     th:src="'/upload/' + ${attach.systemFileName}"/>
                            </div>
                        </div>
                        <div class="videos">
                            <div class="mb-3">
                                <div id="videos" th:each="attach : ${attachList}">
                                <span th:if="${attach.fileType == 2}">
                                    <video controls>
                                        <source th:src="'/upload/' + ${attach.systemFileName}" type="video/mp4"/>
                                        <source th:src="'/upload/' + ${attach.systemFileName}" type="video/webm"/>
                                        <source th:src="'/upload/' + ${attach.systemFileName}" type="video/ogg"/>
                                    </video>
                                </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-5">
                        <label class="visually-hidden" for="content">ÎÇ¥Ïö©</label>
                        <div id="content" th:utext="*{content}"></div>
                    </div>

                    <div class="mb-3 tag-box" th:if="${post.tag != null && post.tag != ''}">
                        <div id="tag">
                            <a th:each="tag : ${post.tags}" th:href="@{/postListByTagName(encodedTagName=${tag})}"><span
                                    th:text="${'#'+tag}"></span></a>
                        </div>
                    </div>
                    <div class="text-end">
                        <a class="btn btn-warning" onClick="editPost()" sec:authorize="isAuthenticated()"
                           th:if="${#authentication.principal.member.memNo} == ${post.writerNo} OR ${#authentication.principal.member.grade} == '5'">ÏàòÏ†ï</a>
                        <a class="btn btn-danger"
                           onClick="removePost()" sec:authorize="isAuthenticated()"
                           th:if="${#authentication.principal.member.memNo} == ${post.writerNo} OR ${#authentication.principal.member.grade} == '5'">ÏÇ≠Ï†ú</a>
                        <!--<a class="btn btn-warning" th:href="@{/post/block/{boardNo}(boardNo=*{boardNo})}">Ïã†Í≥†</a>-->
                        <a class="btn btn-secondary" th:href="@{/boardList/{boardNo}(boardNo=*{boardNo})}">Î™©Î°ù</a>
                    </div>

                    <input id="postNo" name="postNo" th:value="*{postNo}" type="hidden">
                    <input id="boardNo" name="postNo" th:value="*{boardNo}" type="hidden">
                </div>
            </div>

            <!-- ÎåìÍ∏ÄÏãúÏûë -->
            <div class="panel-footer">
                <div class="card">
                    <div class="card-header">
                        <!-- ÎåìÍ∏Ä Îã¨Í∏∞ -->
                        <div id="addComment">
                            <div class="input-group" style="margin-top:10px">
                                <textarea class="form-control" id="addCmtContent" name="addCmtContent"></textarea>
                                <button class="btn btn-primary" id="addCmtBtn" type="button">ÎåìÍ∏Ä Îã¨Í∏∞</button>
                            </div>
                        </div>
                    </div>
                    <!-- ÎåìÍ∏Ä Î™©Î°ù -->
                    <ul class="list-group list-group-flush" id="ListComment">

                        <li class="commont-noline" th:if="${comments==null or comments.isEmpty()}">Ï≤´Î≤àÏß∏ ÎåìÍ∏ÄÏùÑ ÎÇ®Í≤®Î≥¥ÏÑ∏Ïöî‚ú®</li>
                        <li th:class="'commont-line dept_'+${comment.comClass}" th:each="comment : ${comments}"
                            th:id="'comment_'+${comment.comNo}"
                            th:if="${comments!=null and !comments.isEmpty()}">

                            <!-- ÎåìÍ∏Ä ÎÇ¥Ïö© -->
                            <div class="delected-comment" th:if="${comment.isDelect == 1}">
                                <div class="cmtContent">
                                    ÏûëÏÑ±ÏûêÍ∞Ä ÏÇ≠Ï†úÌïú ÎåìÍ∏ÄÏûÖÎãàÎã§.
                                </div>
                            </div>
                            <div class="comment-inner">
                                <div class="info">
                                    <span class="memNick" th:text="${comment.memNick}"></span><span
                                        th:text="${comment.writeday}"></span><input name="memNo"
                                                                                    th:value="${comment.memNo}"
                                                                                    type="hidden">
                                </div>

                                <div class="cmtContent">
                                    <a class="comment-mention" th:href="@{'/member/'+${comment.memNo}}"
                                       th:if="${comment.parentMemNick != null}"
                                       th:text="'@'+${comment.parentMemNick}"></a><span
                                        th:text="${comment.content}"></span>
                                </div>

                                <!-- ÎåìÍ∏Ä ÏÑ§Ï†ï Î©îÎâ¥ -->
                                <div class="comment-menu">
                                    <i aria-hidden="true" class="fa fa-ellipsis-v comment-menu__btn"></i>
                                    <ul style="display:none">
                                        <li sec:authorize="isAuthenticated()"
                                            th:if="${#authentication.principal.member.memNo} == ${comment.memNo} OR ${#authentication.principal.member.grade} == '5'">
                                            <a
                                                    class="link-dark modifyFormBtn" href="#">ÏàòÏ†ï</a></li>
                                        <li sec:authorize="isAuthenticated()"
                                            th:if="${#authentication.principal.member.memNo} == ${comment.memNo} OR ${#authentication.principal.member.grade} == '5'">
                                            <a class="link-dark removeBtn" href="#">ÏÇ≠Ï†ú</a></li>
                                        <!--<li><a class="link-dark commentBlcokBtn" href="#">Ïã†Í≥†</a></li>-->
                                    </ul>
                                </div>
                                <!-- ÎãµÍ∏Ä -->
                                <i aria-hidden="true" class="fa fa-commenting"></i><a
                                    class="btn link-dark dept2CommentOpenBtn"
                                    href="#">ÎãµÍ∏Ä</a>
                                <div aria-expanded="true" class="dept2Comment" style="display:none">
                                    <div class="input-group">
                                    <textarea class="form-control"
                                              placeholder="Î™ÖÏòàÌöåÏÜê, Î¨¥Îã®Í¥ëÍ≥†, Î∂àÎ≤ïÏ†ïÎ≥¥ Ïú†Ìè¨ Ïãú ÏÇ≠Ï†úÎê† Ïàò ÏûàÏäµÎãàÎã§."></textarea>
                                        <button class="btn btn-primary dept2CommentBtn">Îì±Î°ù</button>
                                    </div>
                                </div>
                                <input name="parents" th:value="${comment.parents}" type="hidden">
                            </div>
                        </li>
                    </ul>
                </div>

                <script>
                    const postNo = $("#postNo").val();
                    const boardNo = $("#boardNo").val();
                </script>
                <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=6a8edf3a83107522729d97cbe81e5e44&libraries=services"
                        th:if="${mapVoForApi != null}"
                        type="text/javascript"></script>
                <script th:if="${mapVoForApi != null}">

                    // ÌéòÏù¥ÏßÄ Î°úÎìú ÌõÑ Ïπ¥Ïπ¥Ïò§ ÏßÄÎèÑÏóê Îì±Î°ùÎêú Ï†ïÎ≥¥Î•º ÎÑ£Ïñ¥Ï§ÄÎã§.
                    window.onload = function () {
                        $.ajax({
                            type: "GET",
                            url: "/findMapInfo?postNo=" + postNo,
                            success: function (data) {
                                var documentsList = data.documents;
                                var meta = data.meta;
                                placesSearchCB(documentsList, meta);
                                console.log("ÏûëÎèô")
                            },
                            error: function () {
                                alert("Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®");
                            }
                        });
                    };

                    //Ïπ¥Ïπ¥Ïò§ Ïä§ÌÅ¨Î¶ΩÌä∏

                    // ÎßàÏª§Î•º Îã¥ÏùÑ Î∞∞Ïó¥
                    var markers = [];

                    var mapContainer = document.getElementById('map'), // ÏßÄÎèÑÎ•º ÌëúÏãúÌï† div
                        mapOption = {
                            center: new kakao.maps.LatLng(33.450701, 126.570667), // ÏßÄÎèÑÏùò Ï§ëÏã¨Ï¢åÌëú
                            level: 3 // ÏßÄÎèÑÏùò ÌôïÎåÄ Î†àÎ≤®
                        }

                    // ÏßÄÎèÑ ÏÉùÏÑ±
                    var map = new kakao.maps.Map(mapContainer, mapOption);

                    // HTMLÏùò geolocation ÏÇ¨Ïö©Í∞ÄÎä•Ïù¥Î©¥ ÏÇ¨Ïö©Ïûê ÏúÑÏπòÎ°ú Ï§ëÏã¨ Ïù¥Îèô
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(function (position) {
                            var lat = position.coords.latitude, // ÏúÑÎèÑ
                                lon = position.coords.longitude; // Í≤ΩÎèÑ

                            var locPosition = new kakao.maps.LatLng(lat, lon);
                            map.setCenter(locPosition);
                        });

                    }

                    // Í≤ÄÏÉâ Í≤∞Í≥º Î™©Î°ùÏù¥ÎÇò ÎßàÏª§Î•º ÌÅ¥Î¶≠ÌñàÏùÑ Îïå Ïû•ÏÜåÎ™ÖÏùÑ ÌëúÏ∂úÌï† Ïù∏Ìè¨ÏúàÎèÑÏö∞Î•º ÏÉùÏÑ±Ìï©ÎãàÎã§
                    var infowindow = new kakao.maps.InfoWindow({zIndex: 1});

                    // ÌÇ§ÏõåÎìú Í≤ÄÏÉâÏùÑ ÏöîÏ≤≠ÌïòÎäî Ìï®ÏàòÏûÖÎãàÎã§
                    function searchPlaces() {

                        var keyword = document.getElementById('keyword').value;

                        if (!keyword.replace(/^\s+|\s+$/g, '')) {
                            alert('ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                            return false;
                        }

                        // Ïû•ÏÜåÍ≤ÄÏÉâ Í∞ùÏ≤¥Î•º ÌÜµÌï¥ ÌÇ§ÏõåÎìúÎ°ú Ïû•ÏÜåÍ≤ÄÏÉâÏùÑ ÏöîÏ≤≠Ìï©ÎãàÎã§ -> ÌÇ§ÏõåÎìúÎ•º ÏßÅÏ†ë Î∞õÏïÑ Ï≤òÎ¶¨Î•º Ìï¥Ï§òÏïºÌï® Ï†ïÎ≥¥Í∞Ä ÏóÜÏùÑÍ≤ΩÏö∞ ÏóÜÎã§Í≥† ÏïåÎ¶º
                        $.ajax({
                            type: "GET",
                            url: "/map/search?query=" + keyword,
                            success: function (data) {
                                var documentsList = data.mapResponse.documents;
                                var meta = data.mapResponse.meta;
                                placesSearchCB(documentsList, meta);

                            },
                            error: function () {
                                alert("Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®");
                            }
                        });
                    }

                    // Ïû•ÏÜåÍ≤ÄÏÉâÏù¥ ÏôÑÎ£åÎêêÏùÑ Îïå Ìò∏Ï∂úÎêòÎäî ÏΩúÎ∞±Ìï®Ïàò ÏûÖÎãàÎã§
                    function placesSearchCB(documentsList, meta) {
                        console.log("placesSearchCBÏûëÎèô")
                        if (meta.total_count == 0) {
                            alert("Í≤ÄÏÉâ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.");
                            return false;
                        }

                        // Í≤ÄÏÉâ Î™©Î°ùÍ≥º ÎßàÏª§Î•º ÌëúÏ∂úÌï©ÎãàÎã§
                        displayPlaces(documentsList);

                        // ÌéòÏù¥ÏßÄ Î≤àÌò∏Î•º ÌëúÏ∂úÌï©ÎãàÎã§
                        // displayPagination(meta);
                    }

                    // Í≤ÄÏÉâ Í≤∞Í≥º Î™©Î°ùÍ≥º ÎßàÏª§Î•º ÌëúÏ∂úÌïòÎäî Ìï®ÏàòÏûÖÎãàÎã§
                    function displayPlaces(documentsList) {
                        console.log("displayPlacesÏûëÎèô")
                        var listEl = document.getElementById('placesList'),
                            menuEl = document.getElementById('menu_wrap'),
                            fragment = document.createDocumentFragment(),
                            bounds = new kakao.maps.LatLngBounds(),
                            listStr = '';

                        // Í≤ÄÏÉâ Í≤∞Í≥º Î™©Î°ùÏóê Ï∂îÍ∞ÄÎêú Ìï≠Î™©Îì§ÏùÑ Ï†úÍ±∞Ìï©ÎãàÎã§
                        removeAllChildNods(listEl);

                        // ÏßÄÎèÑÏóê ÌëúÏãúÎêòÍ≥† ÏûàÎäî ÎßàÏª§Î•º Ï†úÍ±∞Ìï©ÎãàÎã§
                        removeMarker();

                        for (var i = 0; i < documentsList.length; i++) {

                            // ÎßàÏª§Î•º ÏÉùÏÑ±ÌïòÍ≥† ÏßÄÎèÑÏóê ÌëúÏãúÌï©ÎãàÎã§
                            var placePosition = new kakao.maps.LatLng(documentsList[i].y, documentsList[i].x),
                                marker = addMarker(placePosition, i),
                                itemEl = getListItem(i, documentsList[i]); // Í≤ÄÏÉâ Í≤∞Í≥º Ìï≠Î™© ElementÎ•º ÏÉùÏÑ±Ìï©ÎãàÎã§

                            // Í≤ÄÏÉâÎêú Ïû•ÏÜå ÏúÑÏπòÎ•º Í∏∞Ï§ÄÏúºÎ°ú ÏßÄÎèÑ Î≤îÏúÑÎ•º Ïû¨ÏÑ§Ï†ïÌïòÍ∏∞ÏúÑÌï¥
                            // LatLngBounds Í∞ùÏ≤¥Ïóê Ï¢åÌëúÎ•º Ï∂îÍ∞ÄÌï©ÎãàÎã§
                            bounds.extend(placePosition);

                            // ÎßàÏª§ÏôÄ Í≤ÄÏÉâÍ≤∞Í≥º Ìï≠Î™©Ïóê mouseover ÌñàÏùÑÎïå
                            // Ìï¥Îãπ Ïû•ÏÜåÏóê Ïù∏Ìè¨ÏúàÎèÑÏö∞Ïóê Ïû•ÏÜåÎ™ÖÏùÑ ÌëúÏãúÌï©ÎãàÎã§
                            // mouseout ÌñàÏùÑ ÎïåÎäî Ïù∏Ìè¨ÏúàÎèÑÏö∞Î•º Îã´ÏäµÎãàÎã§
                            (function (marker, title) {
                                kakao.maps.event.addListener(marker, 'mouseover', function () {
                                    displayInfowindow(marker, title);
                                });

                                kakao.maps.event.addListener(marker, 'mouseout', function () {
                                    infowindow.close();
                                });

                                itemEl.onmouseover = function () {
                                    displayInfowindow(marker, title);
                                };

                                itemEl.onmouseout = function () {
                                    infowindow.close();
                                };
                            })(marker, documentsList[i].place_name);

                            fragment.appendChild(itemEl);
                        }

                        // Í≤ÄÏÉâÍ≤∞Í≥º Ìï≠Î™©Îì§ÏùÑ Í≤ÄÏÉâÍ≤∞Í≥º Î™©Î°ù ElemnetÏóê Ï∂îÍ∞ÄÌï©ÎãàÎã§
                        listEl.appendChild(fragment);
                        menuEl.scrollTop = 0;

                        // Í≤ÄÏÉâÎêú Ïû•ÏÜå ÏúÑÏπòÎ•º Í∏∞Ï§ÄÏúºÎ°ú ÏßÄÎèÑ Î≤îÏúÑÎ•º Ïû¨ÏÑ§Ï†ïÌï©ÎãàÎã§
                        map.setBounds(bounds);
                    }

                    // Í≤ÄÏÉâÍ≤∞Í≥º Ìï≠Î™©ÏùÑ ElementÎ°ú Î∞òÌôòÌïòÎäî Ìï®ÏàòÏûÖÎãàÎã§
                    function getListItem(index, places) {

                        var el = document.createElement('li'),
                            itemStr = '<span class="markerbg marker_' + (index + 1) + '"></span>' +
                                '<div class="info">' +
                                '   <h5>' + places.placeName + '</h5>';

                        if (places.roadAddressName) {
                            itemStr += '    <span>' + places.roadAddressName + '</span>' +
                                '   <span class="jibun gray">' + places.addressName + '</span>';
                        } else {
                            itemStr += '    <span>' + places.addressName + '</span>';
                        }

                        itemStr += '</div>';
                        itemStr += '<a href="' + places.placeUrl + '" target="_blank"><button>ÏÉÅÏÑ∏Î≥¥Í∏∞</a></button>';

                        el.innerHTML = itemStr;
                        el.className = 'item';

                        return el;
                    }

                    // ÎßàÏª§Î•º ÏÉùÏÑ±ÌïòÍ≥† ÏßÄÎèÑ ÏúÑÏóê ÎßàÏª§Î•º ÌëúÏãúÌïòÎäî Ìï®ÏàòÏûÖÎãàÎã§
                    function addMarker(position, idx, title) {
                        var imageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png', // ÎßàÏª§ Ïù¥ÎØ∏ÏßÄ url, Ïä§ÌîÑÎùºÏù¥Ìä∏ Ïù¥ÎØ∏ÏßÄÎ•º ÏîÅÎãàÎã§
                            imageSize = new kakao.maps.Size(36, 37),  // ÎßàÏª§ Ïù¥ÎØ∏ÏßÄÏùò ÌÅ¨Í∏∞
                            imgOptions = {
                                spriteSize: new kakao.maps.Size(36, 691), // Ïä§ÌîÑÎùºÏù¥Ìä∏ Ïù¥ÎØ∏ÏßÄÏùò ÌÅ¨Í∏∞
                                spriteOrigin: new kakao.maps.Point(0, (idx * 46) + 10), // Ïä§ÌîÑÎùºÏù¥Ìä∏ Ïù¥ÎØ∏ÏßÄ Ï§ë ÏÇ¨Ïö©Ìï† ÏòÅÏó≠Ïùò Ï¢åÏÉÅÎã® Ï¢åÌëú
                                offset: new kakao.maps.Point(13, 37) // ÎßàÏª§ Ï¢åÌëúÏóê ÏùºÏπòÏãúÌÇ¨ Ïù¥ÎØ∏ÏßÄ ÎÇ¥ÏóêÏÑúÏùò Ï¢åÌëú
                            },
                            markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imgOptions),
                            marker = new kakao.maps.Marker({
                                position: position, // ÎßàÏª§Ïùò ÏúÑÏπò
                                image: markerImage
                            });

                        marker.setMap(map); // ÏßÄÎèÑ ÏúÑÏóê ÎßàÏª§Î•º ÌëúÏ∂úÌï©ÎãàÎã§
                        markers.push(marker);  // Î∞∞Ïó¥Ïóê ÏÉùÏÑ±Îêú ÎßàÏª§Î•º Ï∂îÍ∞ÄÌï©ÎãàÎã§

                        return marker;
                    }

                    // ÏßÄÎèÑ ÏúÑÏóê ÌëúÏãúÎêòÍ≥† ÏûàÎäî ÎßàÏª§Î•º Î™®Îëê Ï†úÍ±∞Ìï©ÎãàÎã§
                    function removeMarker() {
                        for (var i = 0; i < markers.length; i++) {
                            markers[i].setMap(null);
                        }
                        markers = [];
                    }


                    // Í≤ÄÏÉâÍ≤∞Í≥º Î™©Î°ù ÎòêÎäî ÎßàÏª§Î•º ÌÅ¥Î¶≠ÌñàÏùÑ Îïå Ìò∏Ï∂úÎêòÎäî Ìï®ÏàòÏûÖÎãàÎã§
                    // Ïù∏Ìè¨ÏúàÎèÑÏö∞Ïóê Ïû•ÏÜåÎ™ÖÏùÑ ÌëúÏãúÌï©ÎãàÎã§
                    function displayInfowindow(marker, title) {
                        var content = '<div style="padding:5px;z-index:1;">' + title + '</div>';

                        infowindow.setContent(content);
                        infowindow.open(map, marker);
                    }

                    // Í≤ÄÏÉâÍ≤∞Í≥º Î™©Î°ùÏùò ÏûêÏãù ElementÎ•º Ï†úÍ±∞ÌïòÎäî Ìï®ÏàòÏûÖÎãàÎã§
                    function removeAllChildNods(el) {
                        while (el.hasChildNodes()) {
                            el.removeChild(el.lastChild);
                        }
                    }

                    //  -------------------------- Ïπ¥Ïπ¥Ïò§ ÎÅù ----------------------
                </script>
                <script>
                    $(document).ready(function () {
                        if (window.location.hash.length > 1) {
                            $('html, body').animate({
                                scrollTop: $(window.location.hash).offset().top
                            });
                        }
                    });
                </script>
                <script>
                    // Í∏Ä ÏàòÏ†ï
                    function editPost() {
                        location.href = "/member/post/" + postNo + "/modify"
                    };

                    // Í∏Ä ÏÇ≠Ï†ú
                    function removePost() {
                        const con = confirm("Ìï¥Îãπ Í∏ÄÏùÑ ÏÇ≠Ï†ú ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÏÇ≠Ï†úÎêú Í∏ÄÏùÄ Î≥µÍµ¨Ìï†Ïàò ÏóÜÏäµÎãàÎã§.");
                        if (con == true) {
                            location.href = "/member/post/" + postNo + "/delete"
                        }
                    };


                    $(document).ready(function () {

                        //ÌÉúÍ∑∏ Ï∂úÎ†• ÏÖãÌåÖ
                        // if ($('#tag').length > 0) {
                        //     const str = $('#tag').text();
                        //     const arr = str.split(",");
                        //     let htmlstr = "";
                        //     for (var i = 0; i < arr.length; i++) {
                        //         htmlstr += ` <a href="/"><span>#${arr[i]}</span></a>`;
                        //     }
                        //     $('#tag').html(htmlstr);
                        // }

                        //ÎåìÍ∏Ä ÏûëÏÑ±Ïãú Î°úÍ∑∏Ïù∏ Ïó¨Î∂ÄÏóê Îî∞Îùº placeholderÍ∞í Îã§Î•¥Í≤å Ï∂úÎ†•
                        //ÏûëÏÑ±ÌïòÎ†§Í≥† Ìï† Í≤ΩÏö∞ Î°úÍ∑∏Ïù∏Ï∞ΩÏúºÎ°ú Ïú†ÎèÑ
                        if (typeof g_sUserMemNo === 'undefined') {
                            $("#addCmtContent").attr("placeholder", "Î°úÍ∑∏Ïù∏ ÌõÑ ÎåìÍ∏Ä ÏûëÏÑ±Í∞ÄÎä•Ìï©ÎãàÎã§.");

                            $(document).on("focus", "#addCmtContent", function (e) {
                                const con = confirm(_confirmLoginTxt)
                                if (con == true) {
                                    location.href = _loginPage + "?prevPage=" + encodeURIComponent(location.href);
                                }
                                $(this).blur();
                            });
                        } else {
                            $("#addCmtContent").attr("placeholder", "ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî");
                        }

                        //ÎåìÍ∏Ä Î≥¥Ïù¥Í≤å ÏïàÎ≥¥Ïù¥Í≤å

                        /*<![CDATA[*/
                        var useComment = "[[${useComment}]]";
                        /*]]>*/

                        if (useComment == 0) {
                            document.getElementById("addComment").style.display = "none";
                        } else {
                            document.getElementById("addComment").style.display = "";
                        }

                        //*****ÎåìÍ∏Ä Î™©Î°ù Ï°∞ÌöåAJAX ÏãúÏûë*******//
                        function init(postNo) {

                            const getAjax = function (url, postNo) {
                                return new Promise((resolve, reject) => {
                                    $.ajax({
                                        url: url,
                                        method: 'POST',
                                        dataType: 'json',
                                        data: {
                                            postNo: postNo
                                        },
                                        success: function (data) {
                                            resolve(data);
                                        },
                                        error: function (e) {
                                            reject(e);
                                        }
                                    });
                                });
                            }

                            async function requestProcess(url, postNo) {
                                try {
                                    rs = await getAjax(url, postNo);
                                    $('#ListComment').html("");
                                    let htmlStr = "";

                                    //ÎåìÍ∏ÄÏù¥ Ï°¥Ïû¨ÌïòÏßÄ ÏïäÏùÑ Í≤ΩÏö∞
                                    if (rs.length == 0) {
                                        htmlStr += `<li class="commont-noline" >Ï≤´Î≤àÏß∏ ÎåìÍ∏ÄÏùÑ ÎÇ®Í≤®Î≥¥ÏÑ∏Ïöî‚ú®</li>`;
                                    } else {
                                        //ÎåìÍ∏ÄÏù¥ Ï°¥Ïû¨ÌïòÎäî Í≤ΩÏö∞
                                        for (let i = 0; i < rs.length; i++) {
                                            htmlStr += `<li id="comment_${rs[i].comNo}" class="commont-line dept_${rs[i].comClass}">`
                                            if (rs[i].isDelect == 1) { //ÏÇ≠Ï†úÎêú ÎåìÍ∏ÄÏûÑ
                                                htmlStr += `<div class="delected-comment"><div class="cmtContent">ÏûëÏÑ±ÏûêÍ∞Ä ÏÇ≠Ï†úÌïú ÎåìÍ∏ÄÏûÖÎãàÎã§.</div></div>`;
                                            }
                                            htmlStr += `<div class="comment-inner"><div class="info">`;
                                            htmlStr += `<span class="memNick">${rs[i].memNick}</span>`;
                                            htmlStr += `<span>${rs[i].writeday}</span>`;
                                            htmlStr += `<input type="hidden" name="memNo" value="${rs[i].memNo}">`;
                                            htmlStr += `</div>`;
                                            htmlStr += `<div class="cmtContent">`;
                                            if (rs[i].parentMemNick != null) {
                                                htmlStr += `<a href="/member/${rs[i].memNo}" class="comment-mention">@${rs[i].parentMemNick}</a>`;
                                            }
                                            htmlStr += `<span>${rs[i].content}</span></div>`;
                                            htmlStr += `<div class="comment-menu">`;
                                            htmlStr += `<i class="fa fa-ellipsis-v comment-menu__btn" aria-hidden="true"></i>`;
                                            htmlStr += `<ul style="display:none">`;
                                            if (g_sUserMemNo && g_sUserMemNo == rs[i].memNo) {
                                                htmlStr += `<li><a href="#" class="link-dark modifyFormBtn">ÏàòÏ†ï</a></li>`;
                                                htmlStr += `<li><a href="#" class="link-dark removeBtn">ÏÇ≠Ï†ú</a></li>`;
                                            }
                                            // htmlStr += `<li><a href="#" class="link-dark commentBlcokBtn">Ïã†Í≥†</a></li>`;
                                            htmlStr += `</ul>`;
                                            htmlStr += `</div>`;
                                            htmlStr += `<i class="fa fa-commenting" aria-hidden="true"></i><a href="#" class="btn link-dark dept2CommentOpenBtn">ÎãµÍ∏Ä</a>`;
                                            htmlStr += `<div class="dept2Comment" aria-expanded="true" style="display:none">`;
                                            htmlStr += `<div class="input-group">`;
                                            htmlStr += `<textarea class="form-control" placeholder="Î™ÖÏòàÌöåÏÜê, Î¨¥Îã®Í¥ëÍ≥†, Î∂àÎ≤ïÏ†ïÎ≥¥ Ïú†Ìè¨ Ïãú ÏÇ≠Ï†úÎê† Ïàò ÏûàÏäµÎãàÎã§."></textarea>`;
                                            htmlStr += `<button class="btn btn-primary dept2CommentBtn">Îì±Î°ù</button>`;
                                            htmlStr += `</div>`;
                                            htmlStr += `</div>`;
                                            htmlStr += `<input type="hidden" name="parents" value="${rs[i].parents}">`;
                                            htmlStr += `</div></li>`;
                                        }
                                    }
                                    $('#ListComment').html(htmlStr);
                                } catch (error) {
                                    console.log("error : ", error);
                                }
                            };
                            requestProcess("/comment/list", postNo);
                        };
                        //******ÎåìÍ∏Ä Î™©Î°ù Ï°∞ÌöåAJAX ÎÅù*******//

                        //*****ÎåìÍ∏Ä Îì±Î°ù AJAX ÏãúÏûë*******//
                        function addComment(postNo, cmtContent, comClass, parents, parentMemNo) {
                            const getAjax = function (url, postNo, cmtContent, comClass, parents, parentMemNo) {
                                return new Promise((resolve, reject) => {
                                    $.ajax({
                                        url: url,
                                        method: 'POST',
                                        data: {
                                            postNo: postNo,
                                            content: cmtContent,
                                            comClass: comClass,
                                            parents: parents,
                                            parentMemNo: parentMemNo
                                        },
                                        success: function (data) {
                                            resolve(data);
                                        },
                                        error: function (e) {
                                            reject(e);
                                        }
                                    });
                                });
                            };

                            async function requestProcess(url, postNo, cmtContent, comClass, parents, parentMemNo) {
                                try {
                                    rs = await getAjax(url, postNo, cmtContent, comClass, parents, parentMemNo);
                                    if (rs.result == "OK") {
                                        //ÏõπÏÜåÏºì ÏïåÎ¶º Î∞úÏÜ°
                                        if (rs.isSend == "true") {
                                            const str = JSON.stringify(rs);
                                            websocket.send(str);
                                        }
                                        init(postNo);
                                        // } else if (rs.result == "isNotMember") {
                                        //     const con = confirm(_confirmLoginTxt)
                                        //     if (con == true) {
                                        //         location.href = _loginPage;
                                        //     }
                                    } else {
                                        alert("Îì±Î°ùÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.");
                                        return false;
                                    }
                                    //ÎåìÍ∏Ä ÏûëÏÑ± Ïπ∏ ÎπÑÏö∞Í∏∞
                                    $("#addCmtContent").val("");
                                } catch (error) {
                                    console.log("error : ", error);
                                }
                            };
                            if (!parentMemNo) parentMemNo = 0;

                            requestProcess("/comment/create", postNo, cmtContent, comClass, parents, parentMemNo);
                        };
                        //******ÎåìÍ∏Ä Îì±Î°ùAJAX ÎÅù*******//

                        //*****ÎåìÍ∏Ä ÏàòÏ†ï AJAX ÏãúÏûë*******//
                        function updateComment(cmtContent, comNo) {
                            const getAjax = function (url, cmtContent, comNo) {
                                return new Promise((resolve, reject) => {
                                    $.ajax({
                                        url: url,
                                        method: 'POST',
                                        data: {
                                            content: cmtContent,
                                            comNo: comNo
                                        },
                                        success: function (data) {
                                            resolve(data);
                                        },
                                        error: function (e) {
                                            reject(e);
                                        }
                                    });
                                });
                            };

                            async function requestProcess(url, cmtContent, comNo) {
                                try {
                                    rs = await getAjax(url, cmtContent, comNo);
                                    if (rs == "OK") {
                                        init(postNo);
                                        // } else if (rs == "isNotMember") {
                                        //     const con = confirm(_confirmLoginTxt)
                                        //     if (con == true) {
                                        //         location.href = _loginPage;
                                        //     }
                                    } else if (rs == "denine") {
                                        alert("Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.");
                                        return false;
                                    } else {
                                        alert("ÏàòÏ†ïÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.");
                                        return false;
                                    }
                                } catch (error) {
                                    console.log("error : ", error);
                                }
                            };
                            requestProcess("/comment/update", cmtContent, comNo);
                        };
                        //******ÎåìÍ∏Ä ÏàòÏ†ïAJAX ÎÅù*******//

                        //******ÎåìÍ∏Ä ÏÑ†ÌÉùÏÇ≠Ï†ú AJAX ÏãúÏûë*******//
                        function delectComment(comNo) {
                            const getAjax = function (url, comNo) {
                                return new Promise((resolve, reject) => {
                                    $.ajax({
                                        url: url,
                                        method: 'POST',
                                        data: {
                                            postNo: postNo,
                                            comNo: comNo
                                        },
                                        success: function (data) {
                                            resolve(data);
                                        },
                                        error: function (e) {
                                            reject(e);
                                        }
                                    });
                                });
                            };

                            async function requestProcess(url, comNo) {
                                try {
                                    rs = await getAjax(url, comNo);
                                    if (rs == "OK") {
                                        init(postNo);
                                        // } else if (rs == "isNotMember") {
                                        //     const con = confirm(_confirmLoginTxt)
                                        //     if (con == true) {
                                        //         location.href = _loginPage;
                                        //     }
                                    } else if (rs == "denine") {
                                        alert("Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.");
                                        return false;
                                    } else {
                                        alert("ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.");
                                        return false;
                                    }
                                } catch (error) {
                                    console.log("error : ", error);
                                }
                            };
                            requestProcess("/comment/remove", comNo);
                        };
                        //******ÎåìÍ∏Ä ÏÑ†ÌÉùÏÇ≠Ï†ú AJAX ÎÅù*******//


                        //******ÎåìÍ∏Ä ÏÑ§Ï†ï ÌéºÏπòÍ∏∞ ÏãúÏûë*******//
                        $(document).on("click", '.comment-menu__btn', function (e) {
                            e.preventDefault();

                            $(".comment-menu ul").hide();
                            $(this).next("ul").show();
                        });
                        $(document).click(function (e) {
                            blurClickHide(e, ".comment-menu", ".comment-menu ul");
                        });
                        //******ÎåìÍ∏Ä ÏÑ§Ï†ï ÌéºÏπòÍ∏∞ ÎÅù*******//

                        //ÎåìÍ∏Ä Îì±Î°ù
                        $(document).on("click", '#addCmtBtn', function (e) {
                            e.preventDefault();

                            // location.href = _loginPage + "?prevPage=" + encodeURIComponent(location.href);

                            const cmtContent = $('#addCmtContent').val().trim();
                            if (cmtContent == "") {
                                alert("ÎåìÍ∏Ä ÎÇ¥Ïö©ÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî");
                                return false;
                            }
                            //addComment(Í≤åÏãúÍ∏ÄÎ≤àÌò∏, ÎåìÍ∏Ä ÎÇ¥Ïö©, Í≥ÑÏ∏µ, ÏÉÅÏúÑÎåìÍ∏Ä);
                            addComment(postNo, cmtContent, 0, 0);
                        });

                        //******ÎãµÍ∏Ä Ìèº ÌéºÏπòÍ∏∞ ÏãúÏûë*******//
                        $(document).on("click", '.dept2CommentOpenBtn', function (e) {
                            e.preventDefault();
                            const deptForm = $(this).parents("div").children('.dept2Comment');
                            $(".dept2Comment").hide();
                            deptForm.toggle();
                        });
                        //******ÎåìÍ∏Ä ÏÑ§Ï†ï ÌéºÏπòÍ∏∞ ÎÅù*******//

                        //ÎãµÍ∏Ä Îì±Î°ù
                        $(document).on("click", '.dept2CommentBtn', function (e) {
                            e.preventDefault();

                            const cmtContent = $(this).siblings('textarea').val().trim();
                            const comClass = $(this).parents("li").attr('class').split("dept_")[1] * 1;
                            const parent = $(this).parents(".dept2Comment").next("input[name=parents]").val();
                            const parentMemNo = $(this).parents("li").children(".comment-inner").children(".info").children("input[name=memNo]").val();

                            //ÎåìÍ∏ÄÏùò ÎãµÍ∏ÄÏù∏ Í≤ΩÏö∞
                            if (comClass == 0) {
                                addComment(postNo, cmtContent, 1, parent);
                            } else if (comClass == 1) { //ÎãµÍ∏ÄÏùò ÎãµÍ∏ÄÏù∏ Í≤ΩÏö∞, ÎãµÍ∏ÄÏùò pkÎ•º Ìï®Íªò Ï†ÑÏÜ°ÌïúÎã§.
                                addComment(postNo, cmtContent, 1, parent, parentMemNo);
                            }

                            //addComment(Í≤åÏãúÍ∏ÄÎ≤àÌò∏, ÎåìÍ∏Ä ÎÇ¥Ïö©, Í≥ÑÏ∏µ, ÏÉÅÏúÑÎåìÍ∏Ä);
                        });

                        //ÎåìÍ∏Ä ÏàòÏ†ï Ìèº Ïó¥Í∏∞
                        $(document).on("click", '.modifyFormBtn', function (e) {
                            e.preventDefault();

                            // ÎåìÍ∏Ä pkÍ∞ÄÏ†∏Ïò§Í∏∞
                            const getComNo = $(this).parents('.commont-line').attr('id');
                            const comNo = getComNo.split("_")[1];

                            //Í∏∞Ï°¥Ïóê Ïó¥Î†§ÏûàÎçò ÏàòÏ†ï ÌèºÏù¥ ÏûàÎã§Î©¥ Îã´Í∏∞
                            if ($("#modifyComment").length > 0) {
                                $("#modifyComment").remove();
                            }

                            //ÏàòÏ†ïÌïòÎ†§Îäî ÎåìÍ∏Ä ÎÇ¥Ïö© Í∞ÄÏ†∏ÏôÄÏÑú ÎåìÍ∏Ä ÌèºÏóê Ï∂îÍ∞Ä
                            const content = $(this).parent('li').parent('ul').parent('.comment-menu').siblings(".cmtContent").children('span').html().replace(/(<([^>]+)>)/ig, "").trim();

                            let modifyHtml = "";

                            modifyHtml += `<div id="modifyComment">`;
                            modifyHtml += `<div class="input-group" style="margin-top:10px">`;
                            modifyHtml += `<textarea class="form-control" type="text" id="modifyCmtContent" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî" >${content}</textarea>`;
                            modifyHtml += `<button class="btn btn-outline-secondary" type="button" id="cancel">Ï∑®ÏÜå</button>`;
                            modifyHtml += `<button class="btn btn-outline-secondary" type="button" id="modifyBtn">ÏàòÏ†ï</button>`;
                            modifyHtml += `</div>`;
                            modifyHtml += `</div>`;

                            //ÏàòÏ†ï ÌèºÏùÑ ÏàòÏ†ïÌïòÎ†§Îäî ÎåìÍ∏Ä ÌïòÎã®Ïóê Ï∂îÍ∞Ä
                            $("#" + getComNo).children(".comment-inner").append(modifyHtml);
                        });

                        //ÎåìÍ∏Ä ÏàòÏ†ï
                        $(document).on("click", '#modifyBtn', function (e) {
                            e.preventDefault();
                            const getComNo = $(this).parents('.commont-line').attr('id');
                            const comNo = getComNo.split("_")[1];
                            const cmtContent = $('#modifyCmtContent').val().trim();
                            updateComment(cmtContent, comNo)
                        });

                        //ÎåìÍ∏Ä ÏàòÏ†ï Ï∑®ÏÜå
                        $(document).on("click", '#cancel', function (e) {
                            e.preventDefault();
                            $('#modifyComment').remove();
                        });

                        //ÎåìÍ∏Ä ÏÑ†ÌÉù ÏÇ≠Ï†ú
                        $(document).on("click", '.removeBtn', function (e) {
                            e.preventDefault();
                            const con = confirm("Ìï¥Îãπ ÎåìÍ∏ÄÏùÑ ÏÇ≠Ï†ú ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÏÇ≠Ï†úÎêú ÎåìÍ∏ÄÏùÄ Î≥µÍµ¨Ìï†Ïàò ÏóÜÏäµÎãàÎã§.");
                            if (con == true) {
                                const getComNo = $(this).parents('.commont-line').attr('id');
                                const comNo = getComNo.split("_")[1];
                                delectComment(comNo)
                            }

                        });
                        //******ÎåìÍ∏ÄAJAXÏûëÎèô Ïª®Ìä∏Î°§ ÎÅù*******//
                        const beforeStr = location.hash;
                        const afterStr = beforeStr.split('?')[0].replace("#", "");
                        if (beforeStr != "") {
                            document.getElementById(afterStr).className += ' quick';
                        }
                    });
                </script>

            </div>
        </div>
    </div>
</div>